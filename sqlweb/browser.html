<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>SQL Power!</title>
	<meta name="generator" content="TextMate http://macromates.com/">
	<meta name="author" content="Matt Youell">

	<style>
	.box {
	    border: 1px solid #ccc;
	    background-color: #eee;
    }
    .foo {
        background-color: #eee;
    }

    #txt_email, #txt_password {
     width: 100%;
    }

	</style>
	<script src="jquery-1.4.2.min.js"></script>
	<script>
	var SqlScript = function() {
	    return $('script[language=SQL]').text().trim();
    }

	var SubmitForm = function() {

	    var sql = SqlScript();

	    if( (/^select/i).test(sql) ) {

	     console.log("SELECT found: " + sql);

	     var matches = /^select\s+(.*)\s+from\s+(.*)\s+where\s+(.*);/g.exec(sql);
	     
	     if(matches && matches.length > 2) {
	     
         var jqstr = "$('" + matches[2] + " input[" + matches[3] + "]')";

         console.log(eval(jqstr).length + " items match the query.");

         eval(jqstr).each(function() {
             console.log($(this)[0].id + " = " + $(this)[0].value);
             
             var selector = '#' + $(this)[0].id.replace("txt_", "show_");

             console.log( selector );
             console.log($(selector));

             console.log("Trying to replace this: " + $(selector)[0].innerHTML + " with this: " + "???");
             // $('dd#' + $(this)[0].id.replace("txt_", "show_") ).innerText;

         });

        }
        else {
            console.log("Huh? Match count: " + matches.length);
        }

        }
        else {
            console.log("that's not a select statement?");
	    }

	    return false;

    }

	$(function() {
	    var divs = $('div');
	    divs.addClass("foo");

	    $('#btn_submit').click(SubmitForm);
    });
	</script>

	<script language="SQL">
	select id, value from #registration_form where type="text";
	</script>
</head>
<body>

<div id="box-A" class="box">
    A
    <h5>foo</h5>
</div>

<div id="box-B" class="box">
    B
</div>

<div id="box-C" class="box">
    C
</div>

<div id="box-D" class="box">
    D
</div>

<div id="box-E" class="box">
    E
</div>

<form id="registration_form">
<table style="border: 1px dashed #ccc">
    <tr>
        <td>First</td>
        <td>Last</td>
    </tr>
    <tr>
        <td><input type="text" id="txt_name_first"></td>
        <td><input type="text" id="txt_name_last"></td>
    </tr>
    <tr>
        <td colspan="2">Email</td>
    </tr>
    <tr>
        <td colspan="2"><input type="text" id="txt_email"></td>
    </tr>
    <tr>
        <td colspan="2">Password</td>
    </tr>
    <tr>
        <td colspan="2"><input type="text" id="txt_password"></td>
    </tr>
    <tr>
        <td align="right" colspan="2"><input type="button" id="btn_submit" value="Submit"></td>
    </tr>
</table>
</form>

<dl id="whatever" style="border: 1px red dashed">
    <dt>Form info:</dt>
    <dd id="show_name_first">x</dd>
    <dd id="show_name_last">x</dd>
    <dd id="show_email">x</dd>
    <dd id="show_password">x</dd>
</dl>



</body>
</html>
